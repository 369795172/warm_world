## 成功标准与前提
- 清晰玩法范围：以“轻叙事+农场/生活模拟+镇区社交”作为第一阶段核心循环。
- 技术方向可落地：在现有 React/Vite/Capacitor 背景下给出两条可执行路线（Web 2D 与游戏引擎），对比取舍。
- 度量与成本明确：首版 MVP 的人力、时长、预算与关键风险可量化。
- 与世界观一致：兴趣驱动、长期主义、真实因果在核心系统得到映射。

## 玩法范围（第一阶段建议）
- 基础循环：
  - 农场经营（种植、浇水、收获、季节与天气影响）。
  - 采集与制作（采矿/砍木→合成工具与装饰）。
  - 镇区社交（NPC 日程、好感、委托与节庆）。
  - 时间系统（日夜/季节/节庆/生长周期）。
- 目标风格与美术：
  - 星露谷式像素 2D（低成本、高效率）；或低多边形 3D/Q版（成本较高）。
- 叙事与规则：
  - 无惩罚性语言，以环境反馈呈现后果（真实因果）。
  - 逐步解锁与慢节奏成长（长期主义）。

## 系统模块拆分
- 世界/地图：
  - 2D 瓦片地图（镇区/农场/矿洞/家）；碰撞与导航层。
- 角色与 NPC：
  - 状态机（闲逛/交互/睡眠），日程表与地点偏好；对话树与好感。
- 农场系统：
  - 作物数据表（季节、成熟期、产量、稀有度）；土地状态（湿度/肥力）。
- 采集与制作：
  - 资源点刷新规则；配方系统与工作台 UI。
- 背包与经济：
  - 背包格/堆叠、商店买卖、价格浮动与节庆加成。
- 时间与天气：
  - 全局 tick（30/60fps）驱动；日历/节庆事件；天气影响（概率/连带效果）。
- 任务与事件：
  - 数据驱动触发（条件→效果）；节庆/生日/社区目标。
- 存档与数据：
  - 存档槽/快速存档；校验与兼容；延迟同步（移动端）。
- UI 与体验：
  - 触控命中、手势回退、深色模式一致；关键交互触觉反馈。

## 技术路线选型（两条）
- 路线 A：Web 2D（保留现有栈，最小改动）
  - 引擎：`Phaser` 或 `PixiJS` + `matter.js`（基础物理/碰撞）。
  - UI：继续用 React 负责 HUD/菜单，Canvas 承载游戏画面。
  - 打包：`Capacitor` 封装 iOS/Android；`@capacitor/haptics`、`preferences`、`filesystem`。
  - 离线：`workbox` 预缓存核心资源与场景包；行为记录延迟同步。
  - 优势：与现有代码整合成本低；Web 端与移动端统一发布。
  - 劣势：大型地图/复杂 AI 性能与工具链有限（需优化与自研编辑器）。
- 路线 B：游戏引擎（更强生产力，重写前端）
  - Unity 2D（URP）或 Godot 4（2D）：Tilemap、动画状态机、Nav2D 工具完备。
  - UI：引擎内 UI；Web 端以 WebGL（Unity）或 HTML5（Godot）导出，或仅移动端。
  - 数据：ScriptableObject（Unity）/资源表（Godot），事件与任务用可视化编辑。
  - 优势：更强的编辑器与生态、跨平台与性能更稳。
  - 劣势：与现有 React/Vite 断层重写；导出到 Web/移动的体积较大。

## 架构与数据驱动（A/B 通用思想）
- ECS/组件化：实体（角色/作物/家具）由组件组合（位置、渲染、交互、AI）。
- Tick/调度：全局时间驱动各系统（生长、AI、天气、任务）。
- 数据表：
  - CSV/JSON/TS 资源表（作物、配方、NPC、事件触发条件）。
  - 多语言与数值分层（成长曲线、掉落概率）。
- 事件总线：统一订阅/发布（任务完成、天气变化、好感变化）。
- 存档：版本化 schema、校验与迁移；移动端文件系统与云备份。

## 内容生产流水线
- 地图：Tiled/LDtk（Web 路线）或引擎 Tilemap；图层规范（地形/装饰/碰撞）。
- 作物与物品：表驱动；AI 作者或策划在表内迭代，无需改代码。
- NPC 对话：Yarn Spinner（Unity）或 JSON 对话树；工具内测试。
- 美术资产：像素 2D 首版可控（角色 4 向/8 向、作物 3-5 阶段）。
- 音频：WebAudio/引擎音频；白天/夜晚/节庆 BGM；触觉与音效统一反馈。

## 团队配置与成本估算
- 2D 像素风 MVP（Web 路线 A）
  - 配置：
    - 技术 2 人（前端/玩法工程各 1）。
    - 设计/策划 1 人（系统与数值）。
    - 像素美术 1 人（角色/地图/作物）。
    - 音频 0.5 人（外包为主）。
  - 时长：3–6 个月（核心循环+1 张镇区+基础农场+10 个 NPC）。
  - 预算（人民币，示例，税前）：
    - 工程：3–4 万/人月 × 2 × 4 个月 ≈ 24–32 万。
    - 设计/策划：2.5–3 万/人月 × 4 个月 ≈ 10–12 万。
    - 美术：2.5–3.5 万/人月 × 4 个月 ≈ 10–14 万。
    - 音频与外包：3–6 万。
    - 合计：约 47–64 万 RMB（不含测试与发行渠道成本）。
- 低多边形 3D/Q版（更近“动森”气质）
  - 团队需增加：3D 程序/TA、动画师、3D 场景/角色、技术美术。
  - 时长：9–18 个月（工具链与资产量显著增加）。
  - 预算：200–500 万 RMB 起（小团队 AA 水平，含较多外包）。
- 参考标杆：
  - 《星露谷物语》：单人 4 年（C#/XNA/MonoGame）。
  - 《动物森友会》：大型团队与专有引擎，持续内容与运营投入。

## 时间表与里程碑（Web 2D 路线 A）
- M1：技术基线与框架搭建（Capacitor、Canvas/Phaser、离线/触觉、存档）。
- M2：农场与时间系统可玩（作物 6 种、季节与天气、背包与商店）。
- M3：镇区社交与事件（5–10 NPC、日程与好感、2 个节庆）。
- M4：采集与制作（矿洞一层、10 个配方、装饰与房屋升级）。
- M5：优化与发布（性能/体积、QA、灰度发布、崩溃分析接入）。

## 关键风险与缓解
- 内容体量与制作瓶颈：表驱动工具与外包管理；优先像素 2D。
- 性能与设备碎片化：Canvas 分层渲染、批处理、资源压缩；弱机降级。
- 合规与隐私：最小权限、用途声明、离线优先与数据透明；上架知识库。
- 工具与编辑器：自研轻量数据编辑器或选用现成（Tiled、Yarn）。

## 与现有代码的衔接（docs 背景对齐）
- `HomeScene/GardenScene/TownView` 映射：
  - GardenScene → 农场系统画布与 HUD。
  - TownView → 地图与社交入口；事件看板与日程。
  - HomeScene → 价值交换与分享（商店/合成/成就）。
- Capacitor 插件：`haptics/preferences/filesystem/splash/status-bar/share/browser`。
- 离线与监控：`workbox` + 崩溃分析（Sentry/自建）；健康度指标入埋点。

## 验证指标
- 60fps 稳定、冷启动 < 2.5s；离线命中 ≥ 90%。
- 1 小时留存与次日留存达成预期（原型阶段以小样本验证）。
- 低错误率（崩溃率 < 0.5%），JS 错误收敛；用户反馈正向。

## 建议结论
- 第一阶段选择“Web 2D + Capacitor”的路线 A，3–6 个月做出可玩的原型与早期发行；若后续验证表明内容规模与工具需求显著增长，再评估切换到 Unity/Godot 的路线 B。